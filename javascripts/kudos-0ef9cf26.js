!function(){function t(t){if(this.element=t,this.heartElement=t.querySelector(".kudo-heart"),this.postId=t.getAttribute("data-post-id"),this.loadKudos(),!o())return void(this.heartElement.style.display="none");this.isKudoed=!!e()[this.postId],this.isKudoed&&this.element.classList.add("kudoed"),this.bindEvents()}function e(){if(o){var t=JSON.parse(localStorage.getItem("kudos"));return t||(t={},localStorage.setItem("kudos",JSON.stringify(t))),t}}function o(){return"undefined"!=typeof Storage}t.prototype.bindEvents=function(){var t=this;this.heartElement.addEventListener("mouseup",function(){t.isKudoed?t.removeKudo():t.addKudo()})},t.prototype.loadKudos=function(){this.postRef=firebase.database().ref("/posts/"+this.postId),this.postRef.on("value",function(t){t.val()||this.postRef.set({kudos_count:0}),this.postData=t.val()||{kudos_count:0},this.kudosCount=parseInt(this.postData.kudos_count),this.updateKudoCountDisplay(this.kudosCount),_(this.element).fade("in",100)}.bind(this))},t.prototype.addKudo=function(){var t=e();t[this.postId]=!0,localStorage.setItem("kudos",JSON.stringify(t)),this.toggleKudo("add"),this.displayKudoThanks(),this.isKudoed=!0,this.element.classList.add("kudoed"),this.track("add")},t.prototype.toggleKudo=function(t){var e=this;this.postRef.transaction(function(o){return o&&("add"===t?(o.kudos_count=o.kudos_count||0,o.kudos_count++):(o.kudos_count=o.kudos_count||1,o.kudos_count--),e.kudosCount=o.kudos_count,e.updateKudoCountDisplay(e.kudosCount)),o})},t.prototype.removeKudo=function(){var t=e();delete t[this.postId],localStorage.setItem("kudos",JSON.stringify(t)),this.toggleKudo("remove"),this.updateKudoCountDisplay(this.kudosCount),this.isKudoed=!1,this.element.classList.remove("kudoed"),this.track("remove")},t.prototype.displayKudoThanks=function(){var t=this;this.element.querySelector(".kudo-count-message").style.display="none",this.element.querySelector(".kudo-thanks").style.display="block",setTimeout(function(){_(t.element.querySelector(".kudo-thanks")).fade("out",100),setTimeout(function(){_(t.element.querySelector(".kudo-count-message")).fade("in",100)},110)},1500)},t.prototype.updateKudoCountDisplay=function(t){this.element.querySelector(".kudo-count").textContent=t;var e=1===t?"kudo":"kudos";this.element.querySelector(".kudo-word").textContent=e},t.prototype.track=function(t){ga("send","event","kudo",t,document.querySelector(".post-title").textContent)},document.querySelectorAll(".kudo-container").forEach(function(e){new t(e)})}();